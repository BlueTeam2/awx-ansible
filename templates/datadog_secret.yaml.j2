apiVersion: v1
kind: Secret
metadata:
  name: "{{ datadog_secret_name }}"
  namespace: "{{ datadog_namespace }}"
type: Opaque
data:
  api-key: "{{ lookup('community.hashi_vault.vault_kv2_get',
                        hashicorp_vault_datadog_path,
                        engine_mount_point=hashicorp_vault_datadog_mount_point,
                        auth_method='approle',
                        role_id=hashicorp_vault_approle_ansible_role_id,
                        secret_id=hashicorp_vault_approle_ansible_secret_id,
                        url=hashicorp_vault_server)['secret'].api_key | b64encode }}"
