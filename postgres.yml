---
- name: Postgres server
  hosts: localhost
  # become: yes
  tasks:
    - name: Create admin user
      community.postgresql.postgresql_user:
        login_host: "{{ postgres_host  }}"
        login_user: "{{ postgres_login_user  }}"
        login_password: "{{ postgres_login_password  }}"
        port: "{{ postgres_port  }}"
        name: "{{ postgres_admin_user }}"
        password: "{{ postgres_admin_password }}"
        role_attr_flags: "CREATEDB"

    - name: Create database
      community.postgresql.postgresql_db:
        login_host: "{{ postgres_host  }}"
        login_user: "{{ postgres_admin_user  }}"
        login_password: "{{ postgres_admin_password  }}"
        port: "{{ postgres_port  }}"
        name: "{{ postgres_schedule_database_name }}"
        owner: "{{ postgres_admin_user }}"
        state: present
        
    - name: Restore dump from stage and dev envirnoment
      community.postgresql.postgresql_db:        
        login_host: "{{ postgres_host  }}"
        login_user: "{{ postgres_admin_user  }}"
        login_password: "{{ postgres_admin_password  }}"
        name: "{{ postgres_schedule_database_name }}"
        state: restore
        target: "{{ postgres_initial_data_dest }}"
      when: postgres_restore_dump
      